## 데이터 모델과 성능 학습하기

**성능 데이터 모델링의 정의**

- 데이터베이스 성능향상을 목적으로 설계단계의 데이터 모델링 때부터 성능과 관련된 사항(<u>정규화, 반정규화, 인덱스 등</u>)이 데이터 모델링에 반영될 수 있도록 하는 것이다.

**성능 데이터 모델링 수행시점**

- 비용은 사전에 할수록 비용이 들지 않는다.

  ![스크린샷 2023-10-23 오후 2.53.07](/Users/asthu/Library/Application Support/typora-user-images/스크린샷 2023-10-23 오후 2.53.07.png)

**성능 데이터 모델링 고려사항**

- 데이터 모델링을 할 때 정규화를 정확하게 수행한다
- 데이터베이스 용량산정을 수행한다
- 데이터베이스에 발생되는 트랜잭션의 유형을 파악한다
- 용량과 트랜잭션의 유형에 따라 반정규화를 수행한다
- 이력모델의 조정, PK/FK조정, 슈퍼타입/서브타입 조정 등을 수행한다
- 성능관점에서 데이터 모델을 검증한다

**정규화를 통한 성능 향상 전략**

- 정규화를 수행한다는 것은 데이터를 결정하는 결정자에 의해 함수적 종속을 가지고 있는 일반속성을 의존자로 하여 입력/수정/삭제 이상현상을 제거하는 것이다.
- 데이터의 중복속성을 제거하고 결정자에 의해 동일한 의미의 일반속성이 하나의 테이블로 집약되므로 한 테이블의 데이터 용량이 최소화되는 효과가 있다.
- 따라서 정규화된 테이블은 데이터를 처리할 때 속도가 빨라질 수도 있고 느려질 수도 있는 특성이 있다.

**정규화 이론**

1차, 2차, 3차, 보이스코드정규화는 함수종속성에 근거하여 정규화를 수행

4차 정규화는 속성의 값이 여러 개 발생하는 다치종속

5차 정규화는 조인에 의해 발생하는 이상현상 제거로 정규화 수행

**반정규화의 정의**

- 정규화된 엔티티, 속성, 관계에 대해 시스템의 성능향상과 개발과 운영의 단순화를 위해 <u>중복, 통합, 분리</u> 등을 수행하는 데이터 모델링의 기법을 의미
- 데이터 무결성이 깨질 수 있는 위험을 무릅쓰고 <u>데이터를 중복</u>하여 반정규화를 적용하는 이유는 데이터를 조회할 때 디스크 I/O량이 많아서 성능이 저하되거나 경로가 너무 멀어 조인으로 인한 성능 저하가 예상되거나 컬럼을 계산하여 읽을 때 성능이 저하될 것이 예상되는 경우
- 비정규화는 아예 정규화를 수행하지 않은 모델을 지칭할 때 사용한다.

**테이블에 대한 수평분할/수직분할의 절차**

- 데이터 모델링을 완성한다
- 데이터베이스 용량산정을 한다
- 대량 데이터가 처리되는 테이블에 대해서 트랜잭션 처리 패턴을 분석한다
- 칼럼 단위로 집중화된 처리가 발생하는지, 로우단위로 집중화된 처리가 발생되는지 분석하여 집중화된 단위로 테이블을 분리하는 것을 검토한다

**슈퍼타입/서브타입 모델의 변환방법**

- 성능을 고려한 슈퍼타입과 서브타입의 모델 변환의 방법은 세 가지가 존재한다
- 트랜잭션은 항상 일괄로 처리하는데 테이블은 개별로 유지되어 Union 연산에 의해 성능이 저하될 수 있다.
- 트랜잭션은 항상 서브타입 개별로 처리하는데 테이블은 하나로 통합되어 있어 불필요하게 많은 양의 데이터가 집약되어 있어 성능이 저하되는 경우가 있다
- 트랜잭션은 항상 슈퍼 + 서브타입을 공통으로 처리하는데 개별로 유지되어 있거나 하나의 테이블로 집약되어 있어 성능이 저하되는 경우가 있다

**슈퍼타입/서브타입 모델의 변환 기준**

슈퍼/서브타입을 성능을 고려한 물리적인 데이터 모델로 변환하는 기준은 <u>데이터 양</u>과 테이블에 발생되는 <u>트랜잭션의 유형</u>에 따라 결정해야 한다.

**인덱스 특성을 고려한 PK/FK 데이터베이스 성능향상**

- 데이터를 조회할 때 가장 효과적으로 처리될 수 있도록 접근경로를 제공하는 오브젝트가 바로 인덱스이다. 일반적으로 데이터베이스 테이블에서는 균형 잡힌 트리구조의 B*Tree 구조를 많이 사용한다
- 프로젝트에서 PK/FK설계는 업무적 의미로도 매우 중요한 의미를 가지고 있지만 데이터를 접근할 때 경로를 제공하는 성능의 측면에서도 중요한 의미를 가지고 있기 때문에 성능을 고려한 데이터베이스 설계가  될 수 있도록 설계단계 말에 칼럼의 순서를 조정할 필요가 있다.
- 일반적으로 프로젝트에서는 PK/FK 칼럼 순서의 중요성을 인지하지 못한 채로 데이터 모델링이 되어 있는 그 상태대로 바로 DDL을 생성함으로써 데이터베이스 데이터처리 성능에 문제를 유발하는 경우가 빈번하게 발생이 된다.
- 테이블에 발생되는 트랜잭션의 조회 패턴에 따라 PK/FK컬럼의 순서를 조정해야 한다
- 물리적인 데이터 모델링 단계에서는 스스로 생성된 PK순서 이외에 다른 엔티티로부터 상속받아 발생되는 PK순서까지 항상 주의하여 표시하도록 해야 한다
- 인덱스의 특징은 여러 개의 속성이 하나의 인덱스로 구성되어 있을 때 앞쪽에 위치한 속성의 값이 비교차로 있어야 인덱스가 좋은 효율을 나타낼 수 있다. 앞쪽에 위치한 속성 값이 가급적 '=' 아니면 최소한 범위 'BETWEEN' '<>'가 들어와야 인덱스를 이용할 수 있는 것이다.

**분산 데이터베이스의 개요**

- 여러 곳으로 분산되어 있는 데이터베이스를 하나의 가상 시스템으로 사용할 수 있도록 한 데이터베이스
- 논리적으로 동일한 시스템에 속하지만, 컴퓨터 네트워크를 통해 물리적으로 분산되어 있는 데이터들의 모임. 물리적 Site 분산, 논리적으로 사용자 통합,공유

**분산 데이터베이스의 투명성**

- 분할 투명성 (단편화) : 하나의 논리적 Relation이 여러 단편으로 분할되어 각 단편의 사본이 여러 site에 저장
- 위치 투명성 : 사용하려는 데이터의 저장 장소 명시 불필요, 위치정보가 System Catalog에 유지되어야 함
- 지역사상 투명성 : 지역DBMS와 물리적 DB사이의 Mapping 보장. 각 지역시스템 이름과 무관한 이름 사용 가능
- 중복 투명성 : DB 객체가 여러 site에 중복 되어 있는지 알 필요가 없는 성질
- 장애 투명성 : 구성요소(DBMS, Computer)의 장애에 무관한 Transaction의 원자성 유지
- 병행 투명성 : 다수 Transaction 동시 수행시 결과의 일관성 유지, Time Stamp, 분산 2단계 Locking을 이용 구현

**분산 데이터베이스의 장단점**

- 장점
  - 지역 자치성, 점증적 시스템 용량 확장
  - 신뢰성과 가용성
  - 효용성과 융퉁성
  - 빠른 응답속도와 통신비용 절감
  - 데이터의 가용성과 신뢰성 증가
  - 시스템 규모의 적절한 조절
  - 각 지역 사용자의 요구 수용 증대
- 단점
  - 소프트웨어 개발 비용
  - 오류의 잠재성 증대
  - 처리 비용의 증대
  - 설계, 관리의 복잡성과 비용
  - 불규칙한 응답 속도
  - 통제의 어려움
  - 데이터 무결성에 대한 위협

**데이터베이스 분산구성의 가치**

- 데이터를 분산 환경으로 구성하였을 때 가장 핵심적인 가치는 바로 통합된 데이터베이스에서 제공 할 수 없는 빠른 성능을 제공한다는 점이다.
- 원거리 또는 다른 서버에 접속하여 처리하므로 인해 발생되는 네트워크 부하 및 트랜잭션 집중에 따른 성능 저하의 원인을 분산된 데이터베이스 환경을 구축하므로 빠른 성능을 제공하는 것이 가능해 진다. 바로 이 점 때문에 분산 환경의 데이터베이스를 구축하게 되는 것이다

**테이블 위치 분산**

- 테이블 위치 분산은 테이블의 구조는 변하지 않는다
- 테이블이 다른 데이터베이스에 중복되어 생성되지도 않는다
- 다만 설계된 테이블의 위치를 각각 다르게 위치시키는 것이다

**분산 데이터베이스 적용이 효과적인 경우**

- 성능이 중요한 사이트에 적용해야 한다
- 공통코드, 기준정보, 마스터 데이터 등에 대해 분산환경을 구성하면 성능이 좋아진다
- 실시간 동기화가 요구되지 않을 때 좋다. 거의 실시간의 업무적인 특징을 가지고 있을 때도 분산 환경을 구성할 수 있다
- 특정 서버에 부하가 집중이 될 때 부하를 분산할 때도 좋다
- 백업 사이트를 구성할 때 간단하게 분산기능을 적용하여 구성할 수 있다.

